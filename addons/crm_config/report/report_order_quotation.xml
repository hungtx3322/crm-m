<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_order_quotation">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="crm_config.report_order_quotation_document" t-lang="o.partner_id.lang"/>
            </t>
        </t>
    </template>

    <template id="report_order_quotation_document">
        <t t-call="web.basic_layout">
            <!-- Report Header -->
            <div class="header" style="border: none !important; padding: 0; margin: 0; font-family: 'Times New Roman', serif;">
                <div style="width: 100%; border: none !important; clear: both; overflow: hidden; display: block;">
                    <div style="float: left; width: 22%; text-align: left; border: none !important; padding: 0; margin: 0;">
                        <img src="/crm_config/static/src/pic/Picture1.png" style="max-height: 125px; width: auto; display: block;" alt="Logo"/>
                    </div>
                    <div style="float: left; width: 78%; text-align: center; border: none !important; padding: 0; margin: 0;">
                        <div style="font-size: 17pt; font-weight: bold; font-family: 'Times New Roman', serif; color: #000; margin-bottom: 2px; line-height: 1.1; border: none !important;">
                            CÔNG TY CỔ PHẦN US MASTERBATCH
                        </div>
                        <div style="font-size: 11pt; color: #000; line-height: 1.3; border: none !important; margin-top: 5px; text-align: center;">
                            VPGD: Tòa CT1 Mỹ Đình Plaza 2, số 2 Nguyễn Hoàng, Nam Từ Liêm, Hà Nội.<br/>
                            Nhà máy 1: Tiến Xuân, Thạch Thất, Hà Nội.<br/>
                            Nhà máy 2: KCN Minh Quang, Mỹ Hào, Hưng Yên.<br/>
                            Nhà máy 3: Cụm CN Tiền Tiến, Tp Hòa Bình, Hòa Bình.<br/>
                            Nhà máy 4: KCN Nam Thuận, Đức Hòa, Long An.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Page Content -->
            <div class="page" style="font-family: 'Times New Roman', serif; font-size: 14pt; line-height: 1.4; color: #000;">
                <style>
                    .text-center { text-align: center; }
                    .text-right { text-align: right; }
                    table.order-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
                    table.order-table th, table.order-table td { border: 1px solid #000 !important; padding: 5px 8px; font-size: 13pt; }
                    table.order-table th { background-color: #fff; font-weight: bold; text-align: center; }
                    .terms-list { list-style-type: none; padding-left: 0; margin-top: 10px; }
                    .terms-list li { margin-bottom: 3px; }
                    .terms-list label { font-weight: bold; width: 250px; display: inline-block; }
                </style>

                <h1 style="font-size: 19pt; font-weight: bold; text-align: center; margin: 20px 0 5px;">
                    BẢNG BÁO GIÁ KIÊM ĐƠN ĐẶT HÀNG
                </h1>
                <p style="text-align: center; font-style: italic; margin-bottom: 20px; font-size: 12pt;">
                    (V/v: Báo giá hạt nhựa Taical, hạt nhựa màu, hạt nhựa compound)
                </p>

                <p style="font-weight: bold; margin-bottom: 5px; font-size: 14pt;">
                    Kính gửi: CÔNG TY <span t-field="o.partner_id.name"/>
                </p>

                <div style="text-align: justify; margin-bottom: 15px; font-size: 13pt;">
                    Căn cứ theo nhu cầu sử dụng của Quý công ty.<br/>
                    US Masterbatch trân trọng gửi tới Quý công ty bảng báo giá kiêm đơn đặt hàng theo nhu cầu của quý công ty như sau:
                </div>

                <p style="font-size: 13pt; margin-bottom: 10px;">
                    Mã số đơn hàng/PO số: <span t-field="o.x_so_name"/>
                </p>

                <p style="font-weight: bold; margin-bottom: 5px; font-size: 13pt;">
                    Nội dung đặt hàng:
                </p>

                <table class="order-table">
                    <thead>
                        <tr>
                            <th style="width: 5%;">STT</th>
                            <th style="width: 35%;">Mô tả hàng hóa</th>
                            <th style="width: 15%;">Số lượng</th>
                            <th style="width: 10%;">ĐVT</th>
                            <th style="width: 15%;">Đơn giá</th>
                            <th style="width: 20%;">Thành tiền</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-set="line_num" t-value="1"/>
                        <t t-foreach="o.order_line.filtered(lambda l: not l.display_type)" t-as="line">
                            <tr>
                                <td class="text-center"><span t-esc="line_num"/></td>
                                <td><span t-field="line.product_id.name"/> <span t-field="line.product_id.default_code"/></td>
                                <td class="text-right"><span t-esc="'{:,.0f}'.format(line.product_uom_qty)"/></td>
                                <td class="text-center"><span t-field="line.product_uom_id.name"/></td>
                                <td class="text-right"><span t-esc="'{:,.0f}'.format(line.price_unit)"/></td>
                                <td class="text-right"><span t-esc="'{:,.0f}'.format(line.price_subtotal)"/></td>
                            </tr>
                            <t t-set="line_num" t-value="line_num + 1"/>
                        </t>
                        <tr>
                            <td colspan="5" style="font-weight: bold; text-align: center;">Tổng giá trị đơn hàng (chưa VAT)</td>
                            <td class="text-right" style="font-weight: bold;"><span t-esc="'{:,.0f}'.format(o.amount_untaxed)"/></td>
                        </tr>
                        <tr>
                            <td colspan="5" style="font-weight: bold; text-align: center;">VAT 10%</td>
                            <td class="text-right" style="font-weight: bold;"><span t-esc="'{:,.0f}'.format(o.amount_tax)"/></td>
                        </tr>
                        <tr>
                            <td colspan="5" style="font-weight: bold; text-align: center;">Tổng giá trị thanh toán</td>
                            <td class="text-right" style="font-weight: bold;"><span t-esc="'{:,.0f}'.format(o.amount_total)"/></td>
                        </tr>
                    </tbody>
                </table>

                <p style="font-style: italic; margin-bottom: 20px; font-size: 13pt; text-align: center;">
                    (Số tiền bằng chữ: <t t-esc="o.amount_to_text_vn(o.amount_total)"/>)
                </p>

                <div style="margin-top: 15px; font-size: 13pt;">
                    <ul class="terms-list">
                        <li><label>1. Quy cách đóng gói:</label> <span t-field="o.x_moq"/></li>
                        <li><label>2. Thời gian giao hàng:</label> <span t-field="o.x_time_deliver"/></li>
                        <li><label>3. Địa điểm giao hàng:</label> <span t-field="o.x_local_deliver"/></li>
                        <li><label>4. Chi phí bốc xếp:</label> <span t-field="o.x_expen_diliver"/></li>
                        <li><label>5. Phương thức thanh toán:</label><br/>
                            <div style="padding-left: 20px;">
                                - <span t-field="o.payment_term_id.name"/>.<br/>
                                - <span t-field="o.preferred_payment_method_line_id.name"/>.<br/>
                                CÔNG TY CỔ PHẦN US MASTERBATCH CHI NHÁNH HƯNG YÊN<br/>
                                STK: 4520...<br/>
                                NGÂN HÀNG BIDV CHI NHÁNH VẠN PHÚC - HÀ NỘI
                            </div>
                        </li>
                    </ul>
                </div>

                <div style="width: 100%; margin-top: 30px; font-size: 13pt;">
                    <div style="float: right; text-align: center; width: 50%;">
                        <p style="font-style: italic;">
                            Hà Nội, ngày <t t-if="o.date_order" t-esc="o.date_order.strftime('%d')"/> tháng <t t-if="o.date_order" t-esc="o.date_order.strftime('%m')"/> năm <t t-if="o.date_order" t-esc="o.date_order.strftime('%Y')"/>
                        </p>
                        <p style="font-weight: bold; margin-top: 10px;">US MASTERBATCH JSC</p>
                    </div>
                    <div style="float: left; text-align: center; width: 50%;">
                        <p style="font-weight: bold; margin-top: 35px;">XÁC NHẬN KHÁCH HÀNG</p>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Paper Format -->
    <record id="paperformat_order_quotation_a4" model="report.paperformat">
        <field name="name">A4 Order Quotation</field>
        <field name="default" eval="False"/>
        <field name="format">A4</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">40</field>
        <field name="margin_bottom">20</field>
        <field name="margin_left">15</field>
        <field name="margin_right">15</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">35</field>
        <field name="dpi">96</field>
    </record>

    <!-- Report Action -->
    <record id="action_report_order_quotation" model="ir.actions.report">
        <field name="name">Báo Giá Kiêm Đơn Hàng</field>
        <field name="model">sale.order</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">crm_config.report_order_quotation</field>
        <field name="report_file">crm_config.report_order_quotation</field>
        <field name="print_report_name">'Bao_Gia_Don_Hang_' + (object.name or '')</field>
        <field name="binding_model_id" ref="sale.model_sale_order"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="crm_config.paperformat_order_quotation_a4"/>
    </record>
</odoo>
